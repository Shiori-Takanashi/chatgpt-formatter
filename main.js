/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var w=(r,e)=>{for(var t in e)h(r,t,{get:e[t],enumerable:!0})},D=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of S(e))!q.call(r,n)&&n!==t&&h(r,n,{get:()=>e[n],enumerable:!(o=B(e,n))||o.enumerable});return r};var j=r=>D(h({},"__esModule",{value:!0}),r);var U={};w(U,{default:()=>p});module.exports=j(U);var m=require("obsidian");var b={};w(b,{addAnswerToSecondBlockRule:()=>A,addQuestionToStartRule:()=>T,moveCursorToStartRule:()=>F,quoteAnswerBlockRule:()=>E,quoteQuestionBlockRule:()=>P,selectAllRule:()=>k});var i=(o=>(o.HEAD="\u898B\u51FA\u3057",o.QUOTE="\u5F15\u7528",o.SETUP="\u6E96\u5099",o))(i||{});var F={id:"move-cursor-to-start",name:"\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u982D\u306B\u79FB\u52D5",description:"Alt+C\u5B9F\u884C\u6642\u306B\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u7AE0\u306E\u5148\u982D\u306B\u79FB\u52D5\u3055\u305B\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:0,category:"\u6E96\u5099",apply:r=>r};var k={id:"select-all",name:"Alt+C\u3067\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C",description:"Alt+C\u30DB\u30C3\u30C8\u30AD\u30FC\u3067\u5168\u30C6\u30AD\u30B9\u30C8\u306B\u5BFE\u3057\u3066\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C\u3057\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:1,category:"\u6E96\u5099",apply:r=>r};var A={id:"add-answer-to-second-block",name:"h1=\u56DE\u7B54\u30922\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306B\u8FFD\u52A0",description:"2\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306E\u5148\u982D\u306B\u300C# \u2757\u56DE\u7B54\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!0,order:4,category:"\u898B\u51FA\u3057",apply:r=>{let e=r.split(`

`),t="# \u2757\u56DE\u7B54";return e[1]=t+`
`+e[1],e.join(`

`)}};var T={id:"add-question-to-start",name:"h1=\u8CEA\u554F\u3092\u5148\u982D\u306B\u8FFD\u52A0",description:"\u30C6\u30AD\u30B9\u30C8\u5168\u4F53\u306E\u5148\u982D\u306B\u300C# \u2753\u8CEA\u554F\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!0,order:2,category:"\u898B\u51FA\u3057",apply:r=>"# \u2753\u8CEA\u554F"+`
`+r};var E={id:"quote-answer-block",name:"\u56DE\u7B54\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u56DE\u7B54' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!0,order:5,category:"\u5F15\u7528",apply:r=>{let e=r.split(`

`),t=e[1].split(`
`),o=t.slice(1).map(s=>`> ${s}`),n=[t[0],...o].join(`
`);return[e[0],n,...e.slice(2)].join(`

`)}};var P={id:"quote-question-block",name:"\u8CEA\u554F\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u8CEA\u554F' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!0,order:3,category:"\u5F15\u7528",apply:r=>{let e=r.split(`

`),o=e[0].split(`
`),n=o[0],s=o.slice(1).map(g=>`> ${g}`);return[[n,...s].join(`
`),...e.slice(1)].join(`

`)}};var C=class{constructor(){this.rules=new Map;this.loadAllRules()}loadAllRules(){Object.values(b).forEach(t=>{this.rules.set(t.id,t)})}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled).sort((e,t)=>e.order-t.order)}getRule(e){return this.rules.get(e)}toggleRule(e,t){let o=this.rules.get(e);return o?(o.enabled=t!==void 0?t:!o.enabled,!0):!1}getRulesByCategory(e){return Array.from(this.rules.values()).filter(t=>t.category===e).sort((t,o)=>t.order-o.order)}getAllRules(){return Array.from(this.rules.values()).sort((e,t)=>e.order-t.order)}reorderRule(e,t){let o=this.rules.get(e);return o?(o.order=t,!0):!1}},u=new C;function y(r,e){var n;let t=(e==null?void 0:e.customRules)||u.getEnabledRules();(n=e==null?void 0:e.skipRuleIds)!=null&&n.length&&(t=t.filter(l=>{var s;return!((s=e.skipRuleIds)!=null&&s.includes(l.id))}));let o=r;for(let l of t)try{o=l.apply(o)}catch(s){console.error(`Error applying rule ${l.id}: ${s.message}`)}return o}var x=class{constructor(){this.config={rules:{}};this.plugin=null}async setPlugin(e){this.plugin=e,await this.loadConfig()}async loadConfig(){var e;try{let t=await((e=this.plugin)==null?void 0:e.loadData());t?(this.config=t,this.applyConfig()):this.saveDefaultConfig()}catch(t){console.error(`Failed to load config: ${t.message}`),this.saveDefaultConfig()}}applyConfig(){let{rules:e}=this.config;Object.entries(e).forEach(([t,o])=>{let n=u.getRule(t);n&&(n.enabled=o.enabled,n.order=o.order,o.options&&(n.options={...o.options}))})}async saveConfig(){var e;try{let o={rules:u.getAllRules().reduce((n,l)=>(n[l.id]={enabled:l.enabled,order:l.order,options:l.options},n),{})};await((e=this.plugin)==null?void 0:e.saveData(o))}catch(t){console.error(`Failed to save config: ${t.message}`)}}async saveDefaultConfig(){let e=u.getAllRules().reduce((t,o)=>(t[o.id]={enabled:o.enabled,order:o.order,options:o.options},t),{});this.config={rules:e},await this.saveConfig()}async updateRuleConfig(e,t){let o=u.getRule(e);return o?(t.enabled!==void 0&&(o.enabled=t.enabled),t.order!==void 0&&(o.order=t.order),t.options&&(o.options={...o.options,...t.options}),await this.saveConfig(),!0):!1}},d=new x;var v=class extends m.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o}display(){let{containerEl:t}=this;t.empty(),Object.values(i).forEach(n=>{t.createEl("h2",{text:`${n}`}),u.getRulesByCategory(n).forEach(s=>{let f=new m.Setting(t).setName(s.name).setDesc(s.description||"").addToggle(c=>c.setValue(s.enabled).onChange(async a=>{await d.updateRuleConfig(s.id,{enabled:a})})).addSlider(c=>c.setLimits(1,20,1).setValue(s.order).setDynamicTooltip().onChange(async a=>{await d.updateRuleConfig(s.id,{order:a})}));s.options&&Object.entries(s.options).forEach(([c,a])=>{typeof a=="boolean"?f.addToggle(g=>g.setValue(a).onChange(async R=>{await d.updateRuleConfig(s.id,{options:{[c]:R}})})):typeof a=="string"&&f.addText(g=>g.setValue(a).onChange(async R=>{await d.updateRuleConfig(s.id,{options:{[c]:R}})}))})})})}},p=class extends m.Plugin{async onload(){console.log("ChatGPT Formatter loaded"),await d.setPlugin(this),console.log("configManager.setPlugin(this) finished."),this.addCommand({id:"format-all-text",name:"\u5168\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",hotkeys:[{modifiers:["Alt"],key:"c"}],editorCallback:e=>{try{console.log("format-all-text command: Attempting to move cursor to start."),e.setCursor(0,0),console.log("format-all-text command: Cursor moved to start. Current pos:",e.getCursor());let t=e.getValue();console.log("format-all-text command: Got text, length:",t.length);let o=y(t);console.log("format-all-text command: Text formatted, new length:",o.length),e.setValue(o),console.log("format-all-text command: setValue completed."),e.setCursor(0,0),console.log("format-all-text command: Cursor set to start again. Final pos:",e.getCursor())}catch(t){console.error("Error in format-all-text command:",t)}}}),console.log("format-all-text command registered."),this.addCommand({id:"format-selection",name:"\u9078\u629E\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",editorCallback:e=>{let t=e.getSelection(),o=y(t);e.replaceSelection(o)}}),this.addSettingTab(new v(this.app,this))}async onunload(){await d.saveConfig()}};
