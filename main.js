/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var v=(r,e)=>{for(var t in e)h(r,t,{get:e[t],enumerable:!0})},j=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of q(e))!H.call(r,n)&&n!==t&&h(r,n,{get:()=>e[n],enumerable:!(o=D(e,n))||o.enumerable});return r};var U=r=>j(h({},"__esModule",{value:!0}),r);var L={};v(L,{default:()=>g});module.exports=U(L);var m=require("obsidian");var y={};v(y,{addAnswerToSecondBlockRule:()=>A,addEndSeparatorRule:()=>E,addQuestionToStartRule:()=>T,addSeparatorToHeadingsRule:()=>P,moveCursorToStartRule:()=>w,quoteAnswerBlockRule:()=>S,quoteQuestionBlockRule:()=>B,selectAllRule:()=>k});var l=(o=>(o.HEAD="\u898B\u51FA\u3057",o.QUOTE="\u5F15\u7528",o.SETUP="\u6E96\u5099",o))(l||{});var w={id:"move-cursor-to-start",name:"\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u982D\u306B\u79FB\u52D5",description:"Alt+C\u5B9F\u884C\u6642\u306B\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u7AE0\u306E\u5148\u982D\u306B\u79FB\u52D5\u3055\u305B\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:0,category:"\u6E96\u5099",apply:r=>r};var k={id:"select-all",name:"Alt+C\u3067\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C",description:"Alt+C\u30DB\u30C3\u30C8\u30AD\u30FC\u3067\u5168\u30C6\u30AD\u30B9\u30C8\u306B\u5BFE\u3057\u3066\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C\u3057\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:1,category:"\u6E96\u5099",apply:r=>r};var A={id:"add-answer-to-second-block",name:"h1=\u56DE\u7B54\u30922\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306B\u8FFD\u52A0",description:"2\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306E\u5148\u982D\u306B\u300C# \u2757\u56DE\u7B54\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!1,order:4,category:"\u898B\u51FA\u3057",apply:r=>{let e=r.split(`

`),t="# \u2757\u56DE\u7B54";return e[1]=t+`
`+e[1],e.join(`

`)}};var E={id:"add-end-separator",name:"\u30C6\u30AD\u30B9\u30C8\u7D42\u4E86\u6642\u306B\u30BB\u30D1\u30EC\u30FC\u30BF\u30FC\u3092\u8FFD\u52A0",description:"\u5168\u3066\u306E\u30C6\u30AD\u30B9\u30C8\u304C\u7D42\u4E86\u3057\u305F\u3089\u6539\u884C2\u3064\u3068---\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!1,order:100,category:"\u898B\u51FA\u3057",apply:r=>{let e=r.trimEnd();return e.length>0?e+`

---`:r}};var T={id:"add-question-to-start",name:"h1=\u8CEA\u554F\u3092\u5148\u982D\u306B\u8FFD\u52A0",description:"\u30C6\u30AD\u30B9\u30C8\u5168\u4F53\u306E\u5148\u982D\u306B\u300C# \u2753\u8CEA\u554F\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!1,order:2,category:"\u898B\u51FA\u3057",apply:r=>"# \u2753\u8CEA\u554F"+`
`+r};var P={id:"add-separator-to-headings",name:"\u898B\u51FA\u3057\u306B\u30BB\u30D1\u30EC\u30FC\u30BF\u30FC\u3092\u8FFD\u52A0",description:"1\u756A\u76EE\u306E\u898B\u51FA\u3057\u306E\u4E0B\u306B---\u3092\u3001\u305D\u308C\u4EE5\u5916\u306E\u898B\u51FA\u3057\u306E\u4E0A\u306B---\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!1,order:1,category:"\u898B\u51FA\u3057",apply:r=>{let e=r.split(`
`),t=[],o=!1,n=!1;for(let a=0;a<e.length;a++){let s=e[a];if(s.match(/^```/)){n=!n,t.push(s);continue}if(n){t.push(s);continue}s.match(/^>\s/)?o?(t.push("---"),t.push(s)):(t.push(s),t.push("---"),o=!0):t.push(s)}return t.join(`
`)}};var S={id:"quote-answer-block",name:"\u56DE\u7B54\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u56DE\u7B54' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!1,order:5,category:"\u5F15\u7528",apply:r=>{let e=r.split(`

`),t=e[1].split(`
`),o=t.slice(1).map(s=>`> ${s}`),n=[t[0],...o].join(`
`);return[e[0],n,...e.slice(2)].join(`

`)}};var B={id:"quote-question-block",name:"\u8CEA\u554F\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u8CEA\u554F' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!1,order:3,category:"\u5F15\u7528",apply:r=>{let e=r.split(`

`),o=e[0].split(`
`),n=o[0],s=o.slice(1).map(p=>`> ${p}`);return[[n,...s].join(`
`),...e.slice(1)].join(`

`)}};var b=class{constructor(){this.rules=new Map;this.loadAllRules()}loadAllRules(){Object.values(y).forEach(t=>{this.rules.set(t.id,t)})}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled).sort((e,t)=>e.order-t.order)}getRule(e){return this.rules.get(e)}toggleRule(e,t){let o=this.rules.get(e);return o?(o.enabled=t!==void 0?t:!o.enabled,!0):!1}getRulesByCategory(e){return Array.from(this.rules.values()).filter(t=>t.category===e).sort((t,o)=>t.order-o.order)}getAllRules(){return Array.from(this.rules.values()).sort((e,t)=>e.order-t.order)}reorderRule(e,t){let o=this.rules.get(e);return o?(o.order=t,!0):!1}},u=new b;function C(r,e){var n;let t=(e==null?void 0:e.customRules)||u.getEnabledRules();(n=e==null?void 0:e.skipRuleIds)!=null&&n.length&&(t=t.filter(a=>{var s;return!((s=e.skipRuleIds)!=null&&s.includes(a.id))}));let o=r;for(let a of t)try{o=a.apply(o)}catch(s){console.error(`Error applying rule ${a.id}: ${s.message}`)}return o}var x=class{constructor(){this.config={rules:{}};this.plugin=null}async setPlugin(e){this.plugin=e,await this.loadConfig()}async loadConfig(){var e;try{let t=await((e=this.plugin)==null?void 0:e.loadData());t?(this.config=t,this.applyConfig()):this.saveDefaultConfig()}catch(t){console.error(`Failed to load config: ${t.message}`),this.saveDefaultConfig()}}applyConfig(){let{rules:e}=this.config;Object.entries(e).forEach(([t,o])=>{let n=u.getRule(t);n&&(n.enabled=o.enabled,n.order=o.order,o.options&&(n.options={...o.options}))})}async saveConfig(){var e;try{let o={rules:u.getAllRules().reduce((n,a)=>(n[a.id]={enabled:a.enabled,order:a.order,options:a.options},n),{})};await((e=this.plugin)==null?void 0:e.saveData(o))}catch(t){console.error(`Failed to save config: ${t.message}`)}}async saveDefaultConfig(){let e=u.getAllRules().reduce((t,o)=>(t[o.id]={enabled:o.enabled,order:o.order,options:o.options},t),{});this.config={rules:e},await this.saveConfig()}async updateRuleConfig(e,t){let o=u.getRule(e);return o?(t.enabled!==void 0&&(o.enabled=t.enabled),t.order!==void 0&&(o.order=t.order),t.options&&(o.options={...o.options,...t.options}),await this.saveConfig(),!0):!1}},c=new x;var F=class extends m.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o}display(){let{containerEl:t}=this;t.empty(),Object.values(l).forEach(n=>{t.createEl("h2",{text:`${n}`}),u.getRulesByCategory(n).forEach(s=>{let f=new m.Setting(t).setName(s.name).setDesc(s.description||"").addToggle(d=>d.setValue(s.enabled).onChange(async i=>{await c.updateRuleConfig(s.id,{enabled:i})})).addSlider(d=>d.setLimits(1,20,1).setValue(s.order).setDynamicTooltip().onChange(async i=>{await c.updateRuleConfig(s.id,{order:i})}));s.options&&Object.entries(s.options).forEach(([d,i])=>{typeof i=="boolean"?f.addToggle(p=>p.setValue(i).onChange(async R=>{await c.updateRuleConfig(s.id,{options:{[d]:R}})})):typeof i=="string"&&f.addText(p=>p.setValue(i).onChange(async R=>{await c.updateRuleConfig(s.id,{options:{[d]:R}})}))})})})}},g=class extends m.Plugin{async onload(){console.log("ChatGPT Formatter loaded"),await c.setPlugin(this),console.log("configManager.setPlugin(this) finished."),this.addCommand({id:"format-all-text",name:"\u5168\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",hotkeys:[{modifiers:["Alt"],key:"c"}],editorCallback:e=>{try{console.log("format-all-text command: Attempting to move cursor to start."),e.setCursor(0,0),console.log("format-all-text command: Cursor moved to start. Current pos:",e.getCursor());let t=e.getValue();console.log("format-all-text command: Got text, length:",t.length);let o=C(t);console.log("format-all-text command: Text formatted, new length:",o.length),e.setValue(o),console.log("format-all-text command: setValue completed."),e.setCursor(0,0),console.log("format-all-text command: Cursor set to start again. Final pos:",e.getCursor())}catch(t){console.error("Error in format-all-text command:",t)}}}),console.log("format-all-text command registered."),this.addCommand({id:"format-selection",name:"\u9078\u629E\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",editorCallback:e=>{let t=e.getSelection(),o=C(t);e.replaceSelection(o)}}),this.addSettingTab(new F(this.app,this))}async onunload(){await c.saveConfig()}};
