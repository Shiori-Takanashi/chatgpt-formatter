/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var h=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var T=(r,e)=>{for(var t in e)h(r,t,{get:e[t],enumerable:!0})},M=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of N(e))!q.call(r,n)&&n!==t&&h(r,n,{get:()=>e[n],enumerable:!(o=O(e,n))||o.enumerable});return r};var U=r=>M(h({},"__esModule",{value:!0}),r);var V={};T(V,{default:()=>f});module.exports=U(V);var p=require("obsidian");var y={};T(y,{addAnswerToSecondBlockRule:()=>v,addQuestionToStartRule:()=>E,mergeEmptyLines:()=>A,moveCursorToStartRule:()=>k,quoteAnswerBlockRule:()=>P,quoteQuestionBlockRule:()=>L,removeEmojiUnderEmojiRule:()=>$,selectAllRule:()=>B});var a=(s=>(s.STRUCTURE="\u69CB\u9020",s.CONTENT="\u5185\u5BB9",s.FORMAT="\u66F8\u5F0F",s.SPACING="\u7A7A\u767D\u51E6\u7406",s.CLEANUP="\u30AF\u30EA\u30FC\u30F3\u30A2\u30C3\u30D7",s))(a||{});var v={id:"add-answer-to-second-block",name:"h1=\u56DE\u7B54\u30922\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306B\u8FFD\u52A0",description:"2\u756A\u76EE\u306E\u30D6\u30ED\u30C3\u30AF\u306E\u5148\u982D\u306B\u300C# \u2757\u56DE\u7B54\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!0,order:4,category:"\u5185\u5BB9",apply:r=>{let e=r.split(`

`),t="# \u2757\u56DE\u7B54";return e[1]=t+`
`+e[1],e.join(`

`)}};var E={id:"add-question-to-start",name:"h1=\u8CEA\u554F\u3092\u5148\u982D\u306B\u8FFD\u52A0",description:"\u30C6\u30AD\u30B9\u30C8\u5168\u4F53\u306E\u5148\u982D\u306B\u300C# \u2753\u8CEA\u554F\u300D\u3092\u8FFD\u52A0\u3057\u307E\u3059",enabled:!0,order:2,category:"\u5185\u5BB9",apply:r=>"# \u2753\u8CEA\u554F"+`
`+r};var A={id:"merge-empty-lines",name:"\u9023\u7D9A\u3059\u308B\u7A7A\u884C\u30921\u3064\u306B\u307E\u3068\u3081\u308B",description:"\u9023\u7D9A\u3059\u308B\u7A7A\u884C\u30921\u3064\u306B\u307E\u3068\u3081\u308B\u51E6\u7406\u3002",enabled:!1,order:7,category:"\u5185\u5BB9",apply:r=>{if(r==="")return"";let e=r.split(`
`),t=[];for(let n=0;n<e.length;n++){let s=e[n];s===""&&t.length>0&&t[t.length-1]===""||t.push(s)}let o=t.join(`
`);return o===""&&/^\n+$/.test(r)?`
`:o}};var k={id:"move-cursor-to-start",name:"\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u982D\u306B\u79FB\u52D5",description:"Alt+C\u5B9F\u884C\u6642\u306B\u30AB\u30FC\u30BD\u30EB\u3092\u6587\u7AE0\u306E\u5148\u982D\u306B\u79FB\u52D5\u3055\u305B\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:0,category:"\u69CB\u9020",apply:r=>r};var P={id:"quote-answer-block",name:"\u56DE\u7B54\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u56DE\u7B54' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!0,order:5,category:"\u66F8\u5F0F",apply:r=>{let e=r.split(`

`),t=e[1].split(`
`),o=t.slice(1).map(l=>`> ${l}`),n=[t[0],...o].join(`
`);return[e[0],n,...e.slice(2)].join(`

`)}};var L={id:"quote-question-block",name:"\u8CEA\u554F\u30D6\u30ED\u30C3\u30AF\u3092\u5F15\u7528\u5F62\u5F0F\u306B\u3059\u308B",description:"'# \u8CEA\u554F' \u3092\u542B\u3080\u30D6\u30ED\u30C3\u30AF\u5168\u4F53\u3092\u5F15\u7528\u7B26\u3067\u56F2\u307F\u307E\u3059\u3002",enabled:!0,order:3,category:"\u66F8\u5F0F",apply:r=>{let e=r.split(`

`),o=e[0].split(`
`),n=o[0],l=o.slice(1).map(m=>`> > ${m}`);return[[n,...l].join(`
`),...e.slice(1)].join(`

`)}};var j=["\u{1F60A}","\u{1F914}","\u{1F44D}","\u{1F389}","\u{1F600}","\u{1F44B}","\u{1F44F}","\u{1F9E0}","\u{1F4A1}","\u2728","\u2615\uFE0F","\u{1F680}","\u{1F4BB}","\u2699\uFE0F","\u{1F4DA}","\u{1F4CE}","\u2705","\u2753","\u27A1\uFE0F","\u26A0\uFE0F","\u2139\uFE0F","\u2B50","\u{1F517}","\u{1F4AC}","\u{1F50D}","\u{1F605}","\u{1F60E}","\u{1F622}","\u{1F620}","\u{1F607}","\u{1F60D}","\u{1F634}","\u{1F631}","\u{1F92F}","\u{1F917}","\u{1F624}","\u{1F62D}","\u{1F913}","\u{1F643}","\u{1F928}","\u{1F610}","\u{1F91D}","\u{1F64C}","\u23F3","\u23F1\uFE0F","\u{1F504}","\u274C","\u26D4","\u{1F501}","\u{1F502}","\u{1F197}","\u{1F195}","\u2B06\uFE0F","\u2B07\uFE0F","\u2B05\uFE0F","\u{1F53C}","\u{1F53D}","\u{1F4E4}","\u{1F4E5}","\u{1F4E6}","\u{1F5C3}\uFE0F","\u{1F4C1}","\u{1F5C2}\uFE0F","\u{1F4DD}","\u{1F4D6}","\u{1F9FE}","\u{1F9EE}","\u{1F9F0}","\u{1F58B}\uFE0F","\u{1F9EA}","\u{1F9EC}","\u{1F9F1}","\u{1F5BC}\uFE0F","\u{1F3A8}","\u{1F3AD}","\u{1F3BC}","\u{1F3A7}","\u{1F3AE}","\u{1F579}\uFE0F","\u{1F9D1}\u200D\u{1F4BB}","\u{1F4F1}","\u{1F5A5}\uFE0F","\u{1F5B1}\uFE0F","\u{1F9EF}","\u{1F9F2}","\u{1F4E1}","\u{1F50C}","\u{1F4F6}","\u267B\uFE0F","\u{1F199}","\u{1F310}","\u{1F4C5}","\u{1F552}","\u{1FA84}","\u{1F3C1}","\u{1F4E2}","\u{1F3AF}","\u{1F4C8}","\u{1F4CA}","\u{1F524}","\u{1F5E3}\uFE0F","\u{1F4AD}","\u{1F4CC}","\u{1F5E8}\uFE0F","\u{1FAAB}","\u{1F4C4}","\u{1F5D1}\uFE0F","\u{1F4C9}","\u{1F50E}","\u{1F511}","\u{1F512}","\u{1F513}","\u{1F6E0}\uFE0F","\u{1F9E9}","\u{1F9F5}","\u{1FAA1}","\u{1FAA2}","\u{1F6D1}","\u23F8\uFE0F","\u23F9\uFE0F","\u23FA\uFE0F","\u23F0","\u23F2\uFE0F","\u{1F570}\uFE0F","\u{1F5D3}\uFE0F","\u{1F527} ","\u{1F9E8} ","\u{1FA79} ","\u{1F4E3}","\u{1F50A}","\u{1F509}","\u{1F508}","\u{1F507}","\u{1F514}","\u{1F515}","\u{1FA99}","\u{1FAA7}","\u{1FAB5}","\u{1FA9C}","\u{1FA9E}","\u{1FA9F}","\u{1F9C3}","\u{1F9CA}","\u{1F9FC}","\u{1FAA4}","\u{1FA99}","\u{1F9FF}","\u{1FAAE}","\u{1FAAF}","\u{1F6F8}","\u{1F6F0}\uFE0F","\u{1F9ED}","\u{1F4EF}","\u{1F39B}\uFE0F","\u{1F39A}\uFE0F","\u{1F399}\uFE0F","\u{1F9F3}","\u{1F9FC}","\u{1F97D}","\u{1F6CD}\uFE0F","\u{1F6D2}","\u{1F4E6}","\u{1FA99}","\u{1F52C}","\u{1F9EA}","\u{1F4E0}","\u{1FA9D}","\u{1F9F7}","\u{1FA9B}","\u{1F4C2}","\u{1F587}\uFE0F","\u{1F4DC}","\u{1FAA8}","\u{1FAA3}","\u{1FAA5}","\u{1FA7C}","\u{1F97C}","\u{1F9D1}\u200D\u{1F52C}"];function I(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var D=j.map(I).join("|"),S=new RegExp(`^(#{1,6})(\\s)(${D})(\\s)(.*)$`),C=/^$/,$={id:"remove-emoji-from-specific-pattern",name:"\u7279\u5B9A\u30D1\u30BF\u30FC\u30F3\u306E3\u884C\u76EE\u304B\u3089\u7D75\u6587\u5B57\u3068\u30B9\u30DA\u30FC\u30B9\u3092\u524A\u9664",description:"# \u7D75\u6587\u5B57\u3001\u7A7A\u884C\u3001# \u7D75\u6587\u5B57\u306E\u884C\u304C\u7D9A\u304F\u5834\u5408\u306E\u51E6\u7406\u3002",enabled:!1,order:6,category:"\u5185\u5BB9",apply:r=>{let e=r.split(`
`),t=[],o=0;for(;o<e.length;){if(o+2<e.length){let n=e[o],s=e[o+1],l=e[o+2],g=n.match(S),c=s.match(C),i=l.match(S);if(g&&c&&i){t.push(n),t.push(s);let m=`${i[1]}${i[2]}${i[5]}`;for(t.push(`${m}`),o+=3;o<e.length&&!e[o].match(C);)t.push(`${e[o]}`),o++;o<e.length&&e[o].match(C)&&(t.push(e[o]),o++);continue}}t.push(e[o]),o++}return t.join(`
`)}};var B={id:"select-all",name:"Alt+C\u3067\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C",description:"Alt+C\u30DB\u30C3\u30C8\u30AD\u30FC\u3067\u5168\u30C6\u30AD\u30B9\u30C8\u306B\u5BFE\u3057\u3066\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\u51E6\u7406\u3092\u5B9F\u884C\u3057\u307E\u3059\uFF08UI\u8868\u793A\u7528\uFF09",enabled:!0,order:1,category:"\u69CB\u9020",apply:r=>r};var b=class{constructor(){this.rules=new Map;this.loadAllRules()}loadAllRules(){Object.values(y).forEach(t=>{this.rules.set(t.id,t)})}getEnabledRules(){return Array.from(this.rules.values()).filter(e=>e.enabled).sort((e,t)=>e.order-t.order)}getRule(e){return this.rules.get(e)}toggleRule(e,t){let o=this.rules.get(e);return o?(o.enabled=t!==void 0?t:!o.enabled,!0):!1}getRulesByCategory(e){return Array.from(this.rules.values()).filter(t=>t.category===e).sort((t,o)=>t.order-o.order)}getAllRules(){return Array.from(this.rules.values()).sort((e,t)=>e.order-t.order)}reorderRule(e,t){let o=this.rules.get(e);return o?(o.order=t,!0):!1}},u=new b;function x(r,e){var n;let t=(e==null?void 0:e.customRules)||u.getEnabledRules();(n=e==null?void 0:e.skipRuleIds)!=null&&n.length&&(t=t.filter(s=>{var l;return!((l=e.skipRuleIds)!=null&&l.includes(s.id))}));let o=r;for(let s of t)try{o=s.apply(o)}catch(l){console.error(`Error applying rule ${s.id}: ${l.message}`)}return o}var F=class{constructor(){this.config={rules:{}};this.plugin=null}async setPlugin(e){this.plugin=e,await this.loadConfig()}async loadConfig(){var e;try{let t=await((e=this.plugin)==null?void 0:e.loadData());t?(this.config=t,this.applyConfig()):this.saveDefaultConfig()}catch(t){console.error(`Failed to load config: ${t.message}`),this.saveDefaultConfig()}}applyConfig(){let{rules:e}=this.config;Object.entries(e).forEach(([t,o])=>{let n=u.getRule(t);n&&(n.enabled=o.enabled,n.order=o.order,o.options&&(n.options={...o.options}))})}async saveConfig(){var e;try{let o={rules:u.getAllRules().reduce((n,s)=>(n[s.id]={enabled:s.enabled,order:s.order,options:s.options},n),{})};await((e=this.plugin)==null?void 0:e.saveData(o))}catch(t){console.error(`Failed to save config: ${t.message}`)}}async saveDefaultConfig(){let e=u.getAllRules().reduce((t,o)=>(t[o.id]={enabled:o.enabled,order:o.order,options:o.options},t),{});this.config={rules:e},await this.saveConfig()}async updateRuleConfig(e,t){let o=u.getRule(e);return o?(t.enabled!==void 0&&(o.enabled=t.enabled),t.order!==void 0&&(o.order=t.order),t.options&&(o.options={...o.options,...t.options}),await this.saveConfig(),!0):!1}},d=new F;var w=class extends p.PluginSettingTab{constructor(t,o){super(t,o);this.plugin=o}display(){let{containerEl:t}=this;t.empty(),Object.values(a).forEach(n=>{t.createEl("h2",{text:`${n}`}),u.getRulesByCategory(n).forEach(l=>{let g=new p.Setting(t).setName(l.name).setDesc(l.description||"").addToggle(c=>c.setValue(l.enabled).onChange(async i=>{await d.updateRuleConfig(l.id,{enabled:i})})).addSlider(c=>c.setLimits(1,20,1).setValue(l.order).setDynamicTooltip().onChange(async i=>{await d.updateRuleConfig(l.id,{order:i})}));l.options&&Object.entries(l.options).forEach(([c,i])=>{typeof i=="boolean"?g.addToggle(m=>m.setValue(i).onChange(async R=>{await d.updateRuleConfig(l.id,{options:{[c]:R}})})):typeof i=="string"&&g.addText(m=>m.setValue(i).onChange(async R=>{await d.updateRuleConfig(l.id,{options:{[c]:R}})}))})})})}},f=class extends p.Plugin{async onload(){console.log("ChatGPT Formatter loaded"),await d.setPlugin(this),console.log("configManager.setPlugin(this) finished."),this.addCommand({id:"format-all-text",name:"\u5168\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",hotkeys:[{modifiers:["Alt"],key:"c"}],editorCallback:e=>{try{console.log("format-all-text command: Attempting to move cursor to start."),e.setCursor(0,0),console.log("format-all-text command: Cursor moved to start. Current pos:",e.getCursor());let t=e.getValue();console.log("format-all-text command: Got text, length:",t.length);let o=x(t);console.log("format-all-text command: Text formatted, new length:",o.length),e.setValue(o),console.log("format-all-text command: setValue completed."),e.setCursor(0,0),console.log("format-all-text command: Cursor set to start again. Final pos:",e.getCursor())}catch(t){console.error("Error in format-all-text command:",t)}}}),console.log("format-all-text command registered."),this.addCommand({id:"format-selection",name:"\u9078\u629E\u30C6\u30AD\u30B9\u30C8\u3092\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8",editorCallback:e=>{let t=e.getSelection(),o=x(t);e.replaceSelection(o)}}),this.addSettingTab(new w(this.app,this))}async onunload(){await d.saveConfig()}};
